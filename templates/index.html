<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Customer Feedback Analyzer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #0d1117;
      color: #e6edf3;
      font-family: "Segoe UI", sans-serif;
    }
    .card {
      background-color: #161b22;
      border-radius: 12px;
      color: #e6edf3;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    .form-card {
      max-width: 700px;
      margin: 0 auto 2rem auto;
    }
    .feedback-card {
      min-height: 140px;
      transition: transform 0.3s ease;
      margin-bottom: 1rem;
    }
    .feedback-card:hover {
      transform: scale(1.03);
    }
    .positive { border-left: 5px solid #28a745; }
    .neutral  { border-left: 5px solid #ffc107; }
    .mixed    { border-left: 5px solid #ffca2c; }
    .negative { border-left: 5px solid #dc3545; }

    /* Vertical auto-scroll */
    .feedback-carousel {
      height: 400px; /* visible area */
      overflow: hidden;
      position: relative;
    }
    .feedback-track {
      display: flex;
      flex-direction: column;
      animation: scrollY 20s linear infinite;
    }
    .feedback-track:hover {
      animation-play-state: paused;
    }
    @keyframes scrollY {
      0%   { transform: translateY(0); }
      100% { transform: translateY(-50%); }
    }

    .stars { color: #ffd700; } /* gold stars */
    .insight-card {
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 8px;
    }
    .insight-praises { background: rgba(40,167,69,0.2); border: 1px solid #28a745; }
    .insight-pains   { background: rgba(220,53,69,0.2); border: 1px solid #dc3545; }
    .insight-rec     { background: rgba(0,123,255,0.2); border: 1px solid #007bff; }
  </style>
</head>
<body>
  <div class="container py-4">
    <!-- Title -->
    <h1 class="text-center mb-4">Customer Feedback Analyzer</h1>
    <p class="text-center text-secondary">Turn feedback into actionable insights with the power of AI.</p>

    <!-- Feedback Form -->
<div class="card form-card shadow">
  <div class="card-body">
    <h5 class="card-title text-center">Submit Your Feedback</h5>
    <form method="POST" action="/">
      <div class="mb-3">
        <label for="name" class="form-label">Your Name</label>
        <input type="text" class="form-control" id="name" name="name" placeholder="e.g. Jane Doe" required>
      </div>
      <div class="mb-3">
        <label for="feedback_text" class="form-label">Feedback</label>
        <textarea class="form-control" id="feedback_text" name="feedback_text" placeholder="What's on your mind?" rows="3" required></textarea>
      </div>
      <div class="mb-3">
        <label for="rating" class="form-label">Rating</label>
        <select class="form-select" id="rating" name="rating" required>
          <option value="1">★☆☆☆☆</option>
          <option value="2">★★☆☆☆</option>
          <option value="3">★★★☆☆</option>
          <option value="4">★★★★☆</option>
          <option value="5">★★★★★</option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary w-100">Submit Feedback</button>

      <!-- ✅ Success or error messages -->
      {% if success_message %}
        <p class="text-success text-center mt-2">{{ success_message }}</p>
      {% elif error %}
        <p class="text-danger text-center mt-2">{{ error }}</p>
      {% endif %}
    </form>
  </div>
</div>

    <!-- Two Column Layout -->
    <div class="row">
      <!-- Submitted Feedback -->
      <div class="col-md-6 mb-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5>Submitted Feedback</h5>
          <form method="POST" action="/analyze">
            <button type="submit" class="btn btn-info btn-sm">Analyze All</button>
          </form>
        </div>
        {% if feedbacks %}
        <div class="feedback-carousel">
          <div class="feedback-track">
            <!-- Original cards -->
            {% for fb in feedbacks %}
            <div class="card feedback-card shadow 
              {% if classifications and classifications[loop.index0] %}
                {% if classifications[loop.index0].split(': ')[1] == 'Positive' %}positive
                {% elif classifications[loop.index0].split(': ')[1] == 'Negative' %}negative
                {% elif classifications[loop.index0].split(': ')[1] == 'Mixed' %}mixed
                {% else %}neutral
                {% endif %}
              {% else %}
                {% if fb['rating'] >= 4 %}positive
                {% elif fb['rating'] == 3 %}neutral
                {% else %}negative
                {% endif %}
              {% endif %}">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <h6 class="card-title">{{ fb['name'] }}</h6>
                  {% if classifications and classifications[loop.index0] %}
                    {% if classifications[loop.index0].split(': ')[1] == 'Positive' %}
                      <span class="badge bg-success">Positive</span>
                    {% elif classifications[loop.index0].split(': ')[1] == 'Negative' %}
                      <span class="badge bg-danger">Negative</span>
                    {% elif classifications[loop.index0].split(': ')[1] == 'Mixed' %}
                      <span class="badge bg-warning text-dark">Mixed</span>
                    {% else %}
                      <span class="badge bg-warning text-dark">Neutral</span>
                    {% endif %}
                  {% else %}
                    {% if fb['rating'] >= 4 %}
                      <span class="badge bg-success">Positive</span>
                    {% elif fb['rating'] == 3 %}
                      <span class="badge bg-warning text-dark">Neutral</span>
                    {% else %}
                      <span class="badge bg-danger">Negative</span>
                    {% endif %}
                  {% endif %}
                </div>
                <p class="card-text mt-2">{{ fb['feedback_text'] }}</p>
                <div class="stars">
                  {% for i in range(fb['rating']) %}★{% endfor %}
                  {% for i in range(5 - fb['rating']) %}☆{% endfor %}
                </div>
              </div>
            </div>
            {% endfor %}

            <!-- Duplicate cards for seamless scroll -->
            {% for fb in feedbacks %}
            <div class="card feedback-card shadow 
              {% if classifications and classifications[loop.index0] %}
                {% if classifications[loop.index0].split(': ')[1] == 'Positive' %}positive
                {% elif classifications[loop.index0].split(': ')[1] == 'Negative' %}negative
                {% elif classifications[loop.index0].split(': ')[1] == 'Mixed' %}mixed
                {% else %}neutral
                {% endif %}
              {% else %}
                {% if fb['rating'] >= 4 %}positive
                {% elif fb['rating'] == 3 %}neutral
                {% else %}negative
                {% endif %}
              {% endif %}">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <h6 class="card-title">{{ fb['name'] }}</h6>
                  {% if classifications and classifications[loop.index0] %}
                    {% if classifications[loop.index0].split(': ')[1] == 'Positive' %}
                      <span class="badge bg-success">Positive</span>
                    {% elif classifications[loop.index0].split(': ')[1] == 'Negative' %}
                      <span class="badge bg-danger">Negative</span>
                    {% elif classifications[loop.index0].split(': ')[1] == 'Mixed' %}
                      <span class="badge bg-warning text-dark">Mixed</span>
                    {% else %}
                      <span class="badge bg-warning text-dark">Neutral</span>
                    {% endif %}
                  {% else %}
                    {% if fb['rating'] >= 4 %}
                      <span class="badge bg-success">Positive</span>
                    {% elif fb['rating'] == 3 %}
                      <span class="badge bg-warning text-dark">Neutral</span>
                    {% else %}
                      <span class="badge bg-danger">Negative</span>
                    {% endif %}
                  {% endif %}
                </div>
                <p class="card-text mt-2">{{ fb['feedback_text'] }}</p>
                <div class="stars">
                  {% for i in range(fb['rating']) %}★{% endfor %}
                  {% for i in range(5 - fb['rating']) %}☆{% endfor %}
                </div>
              </div>
            </div>
            {% endfor %}

          </div>
        </div>
        {% else %}
        <p class="text-secondary">No feedback submitted yet.</p>
        {% endif %}
      </div>

      <!-- AI Insights -->
      <div class="col-md-6 mb-4">
        <h5>AI-Generated Insights</h5>
        {% if show_feedback and classifications and pain_summary and praise_summary and recommendation %}
          <div class="insight-card insight-praises">
            <h6>Key Praises</h6>
            <p>{{ praise_summary }}</p>
          </div>
          <div class="insight-card insight-pains">
            <h6>Key Pain Points</h6>
            <p>{{ pain_summary }}</p>
          </div>
          <div class="insight-card insight-rec">
            <h6>Actionable Recommendation</h6>
            <p>{{ recommendation }}</p>
          </div>
        {% elif error %}
          <p class="text-danger">Error: {{ error }}</p>
        {% else %}
          <p class="text-secondary">Submit feedback and click "Analyze All" to see insights.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
